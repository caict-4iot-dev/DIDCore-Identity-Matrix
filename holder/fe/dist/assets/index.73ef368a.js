import{v as P,u as O,c as J,d as R,e as f,a as U,f as F,g as A,b as E}from"./index.8bc7e9a0.js";import{E as u,g as $,a as M}from"./index.6a75cc6f.js";import{a as y,a3 as q,w as G,q as z,an as p,o as H,b as Y,_ as s,U as n,Y as r,e as c,Z as g}from"./vue.2af5998e.js";const Z={class:"policy"},L={style:{"margin-bottom":"10px"}},Q={class:"dialog-footer"},W={class:"dialog-contain"},X={style:{"margin-bottom":"10px"}},ee={style:{"margin-bottom":"10px"}},te={style:{"margin-bottom":"10px"}},ae={style:{"margin-bottom":"10px"}},oe={style:{"margin-bottom":"10px"}},le={class:"dialog-contain-documentTemplate"},se={class:"dialog-footer"},ie=y({name:"policyIndex"}),de=y({...ie,setup(ne){const e=q({documentId:"",editDocumentVal:"",bid:"did:bid:efjuJxqFwfmKBjKPdMGguR9RdGvCSFKH",alias:"",publickey:"b06566e6a1b5a6c761c174d32b4da69142ba190b62e23161b091433819b211e66ce2d6",privateKey:"",documentDisabled:!0,documentPopupVisible:!1,createDocumentDisabled:!1,documentValue:"",statusObj:{0:"审核中",1:"审核通过",2:"审核拒绝"},cerTemplateSubjectData:[],cerTemplateSelectData:[],credentialType:"",credentialFormData:{name:"",phone:""},showVcData:"",creDialogVisible:!1,verDialogVisible:!1,tableData1:[],verBid:"",verResult:"",credentialAddress:"http://localhost:7001/createCredential",verifyAddress:"http://localhost:7004/verCredential"}),_=async a=>{console.log("raw",a);let t=await P({document:JSON.parse(a.document)});t.data.success?u({type:"success",message:t.data.message}):u({type:"error",message:t.data.message})},D=async()=>{let a=JSON.parse(localStorage.getItem("userInfo")),t=e.editDocumentVal,i={id:e.documentId,bid:a.bid,document:t},d=await O(i);console.log("res: ",d),d.code==200?(u({type:"success",message:d.msg}),e.verDialogVisible=!1):u({type:"error",message:d.msg})},v=async()=>{let a={bid:e.bid,privateKey:e.privateKey,document:e.documentValue,alias:e.alias},t=await J(a);console.log("res: ",t),u({type:"success",message:t.msg}),e.creDialogVisible=!1},V=(a,t)=>a.substring(0,t)+"...",w=async()=>{let a=await R({});console.log("res111: ",a),a.code==200&&(typeof a.data=="object"?(a.data.doc=V(a.data.document,12),e.tableData1=[a.data],console.log("state.tableData: ",e.tableData1)):e.tableData1=a.data)},h=()=>{$.confirm("是否需要生成文档加密字段","",{confirmButtonText:"是",cancelButtonText:"否",center:!0}).then(async()=>{let a={bid:e.bid,proofFlag:!0,privateKey:e.privateKey,publickey:e.publickey},t=await f(a);console.log("res: ",t),e.documentValue=JSON.stringify(t.data),console.log("state.documentValue: ",e.documentValue),u({type:"success",message:t.msg})}).catch(async()=>{let a={bid:e.bid,proofFlag:!1,privateKey:e.privateKey,publickey:e.publickey},t=await f(a);console.log("res: ",t),u({type:"success",message:t.msg})})},x=a=>{console.log("vc: ",a),e.verDialogVisible=!0,e.editDocumentVal=JSON.stringify(a.document),e.documentId=a.id},C=()=>{e.verDialogVisible=!1,e.verResult="",e.verBid=""},K=()=>{e.cerTemplateSubjectData=[],e.credentialType="",e.creDialogVisible=!1},T=()=>{e.creDialogVisible=!0;let a=JSON.parse(localStorage.getItem("userInfo"));console.log("data: ",a),e.bid=a.bid,e.publickey=a.publicKey},k=async()=>{var t,i,d,b;let{data:a}=await U.post("http://localhost:7002/findAgentCredentialBybid",{});if(a.code==200){for(const o of a.data){let m=await F({messageId:Number(o.recordId)});console.log("res",m),o.status=e.statusObj[m.data.status],o.certificate_vc=JSON.parse(o.certificate_vc),o.credentialName=(t=o.certificate_vc.credentialSubject)==null?void 0:t.credentialType,o.issuanceDate=B(o.created_time),o.creBid=o.credential_bid,o.vc=(d=(i=o==null?void 0:o.certificate_vc)==null?void 0:i.proof)!=null&&d.jwt?I((b=o.certificate_vc.proof)==null?void 0:b.jwt):""}e.tableData=a.data}},S=async()=>{let a=await A({});console.log("res",a),a.code===200&&(e.cerTemplateSelectData=a.data)},B=a=>{const t=new Date(a),i={year:"numeric",month:"long",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1};return new Intl.DateTimeFormat("zh-CN",i).format(t)};function I(a){const t=a.split("."),i=E.Buffer.from(t[1],"base64").toString("utf-8");return JSON.parse(i)}return G(()=>{e.privateKey?(e.documentDisabled=!1,e.documentPopupVisible=!0):(e.documentDisabled=!0,e.documentPopupVisible=!1),e.documentValue?e.createDocumentDisabled=!1:e.createDocumentDisabled=!0}),z(()=>{S(),w()}),k(),(a,t)=>{const i=p("el-button"),d=p("el-table-column"),b=p("el-table"),o=p("el-input"),m=p("el-dialog"),N=p("el-popover");return H(),Y("div",Z,[s(i,{style:{"margin-left":"1300px"},type:"primary",onClick:T},{default:n(()=>[r("创建文档")]),_:1}),s(b,{data:e.tableData1,style:{width:"100%"}},{default:n(()=>[s(d,{label:"id",prop:"id",width:"220"}),s(d,{label:"bid",prop:"bid",width:"420"}),s(d,{label:"document",prop:"doc",width:"420"}),s(d,{label:"操作","min-width":"130"},{default:n(l=>[s(i,{type:"primary",onClick:j=>_(l.row)},{default:n(()=>[r(" 验证文档 ")]),_:2},1032,["onClick"]),s(i,{type:"primary",onClick:j=>x(l.row)},{default:n(()=>[r(" 修改文档 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),s(m,{modelValue:e.verDialogVisible,"onUpdate:modelValue":t[3]||(t[3]=l=>e.verDialogVisible=l),"before-close":C,title:"Tips",width:"780"},{footer:n(()=>[c("div",Q,[s(i,{type:"primary",onClick:t[2]||(t[2]=l=>D())},{default:n(()=>[r("修改文档")]),_:1})])]),default:n(()=>[c("div",null,[c("p",L,[r("私钥: "),s(o,{modelValue:e.privateKey,"onUpdate:modelValue":t[0]||(t[0]=l=>e.privateKey=l),placeholder:"Please input privateKey",style:{width:"240px"}},null,8,["modelValue"])]),s(o,{modelValue:e.editDocumentVal,"onUpdate:modelValue":t[1]||(t[1]=l=>e.editDocumentVal=l),rows:16,placeholder:"Please input",style:{width:"720px"},type:"textarea"},null,8,["modelValue"])])]),_:1},8,["modelValue"]),s(m,{modelValue:e.creDialogVisible,"onUpdate:modelValue":t[9]||(t[9]=l=>e.creDialogVisible=l),"before-close":K,title:"Tips",width:"780"},{footer:n(()=>[c("div",se,[s(i,{disabled:e.createDocumentDisabled,type:"primary",onClick:t[8]||(t[8]=l=>v())},{default:n(()=>[r("创建文档 ")]),_:1},8,["disabled"])])]),default:n(()=>[c("div",W,[c("div",null,[c("p",X,"bid："+g(e.bid),1),c("p",ee,[r("私钥: "),s(o,{modelValue:e.privateKey,"onUpdate:modelValue":t[4]||(t[4]=l=>e.privateKey=l),placeholder:"Please input privateKey",style:{width:"240px"}},null,8,["modelValue"])]),c("p",te,"公钥："+g(e.publickey),1),c("p",ae,[r("文档： "),s(o,{modelValue:e.documentValue,"onUpdate:modelValue":t[5]||(t[5]=l=>e.documentValue=l),rows:15,placeholder:"Please input",style:{width:"440px"},type:"textarea"},null,8,["modelValue"])]),c("p",oe,[r("别名: "),s(o,{modelValue:e.alias,"onUpdate:modelValue":t[6]||(t[6]=l=>e.alias=l),placeholder:"Please input privateKey",style:{width:"240px"}},null,8,["modelValue"])])]),c("div",le,[s(N,{disabled:e.documentPopupVisible,width:200,content:"请先输入私钥",placement:"top-start",trigger:"hover"},{reference:n(()=>[s(i,{disabled:e.documentDisabled,type:"primary",onClick:t[7]||(t[7]=l=>h())},{default:n(()=>[r("生成文档模板 ")]),_:1},8,["disabled"])]),_:1},8,["disabled"])])])]),_:1},8,["modelValue"])])}}});const pe=M(de,[["__scopeId","data-v-56f7c211"]]);export{pe as default};
