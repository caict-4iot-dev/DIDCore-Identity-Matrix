import{a as h,f as T,g as S,b as w}from"./index.8bc7e9a0.js";import{a as b,a3 as j,w as N,q as x,an as r,o as n,b as p,e as m,Y as u,_ as f,U as _,F as C,ad as V,T as B}from"./vue.2af5998e.js";import{a as O}from"./index.6a75cc6f.js";const k={class:"policy"},I=b({name:"policyIndex"}),A=b({...I,setup(F){const a=j({statusObj:{0:"审核中",1:"审核通过",2:"审核拒绝"},cerTemplateSubjectData:[],cerTemplateSelectData:[],credentialType:"",credentialFormData:{name:"",phone:""},showVcData:"",creDialogVisible:!1,verDialogVisible:!1,tableData:[],verBid:"",verResult:"",credentialAddress:"http://localhost:7001/createCredential",verifyAddress:"http://localhost:7004/verCredential"}),y=()=>{window.open("http://localhost:8888/creDentialList","_blank")},i=async()=>{var o,l,c,s;let{data:t}=await h.post("http://localhost:7001/findAgentCredentialBybid",{});if(t.code==200){for(const e of t.data){let d=await T({messageId:Number(e.recordId)});console.log("res",d),e.status=a.statusObj[d.data.status],e.certificate_vc=JSON.parse(e.certificate_vc),e.credentialName=(o=e.certificate_vc.credentialSubject)==null?void 0:o.credentialType,e.issuanceDate=v(e.created_time),e.creBid=e.credential_bid,e.vc=(c=(l=e==null?void 0:e.certificate_vc)==null?void 0:l.proof)!=null&&c.jwt?D((s=e.certificate_vc.proof)==null?void 0:s.jwt):""}a.tableData=t.data}},g=async()=>{let t=await S({});console.log("res",t),t.code===200&&(a.cerTemplateSelectData=t.data)},v=t=>{const o=new Date(t),l={year:"numeric",month:"long",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1};return new Intl.DateTimeFormat("zh-CN",l).format(o)};function D(t){const o=t.split("."),l=w.Buffer.from(o[1],"base64").toString("utf-8");return JSON.parse(l)}return N(()=>{a.cerTemplateSelectData.forEach(t=>{console.log("item.templateSubject: ",t.templateSubject),t.templateName===a.credentialType&&(a.cerTemplateSubjectData=JSON.parse(t.templateSubject),console.log("state.cerTemplateSubjectData: ",a.cerTemplateSubjectData))})}),x(()=>{g(),i()}),i(),(t,o)=>{const l=r("el-option"),c=r("el-select"),s=r("el-button");return n(),p("div",k,[m("div",null,[u(" 申请凭证类型： "),f(c,{modelValue:a.credentialType,"onUpdate:modelValue":o[0]||(o[0]=e=>a.credentialType=e),placeholder:"Select",size:"large",style:{width:"240px"}},{default:_(()=>[(n(!0),p(C,null,V(a.cerTemplateSelectData,e=>(n(),B(l,{key:e.id,label:e.templateName,value:e.templateName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),m("div",null,[f(s,{type:"primary",onClick:y},{default:_(()=>[u("申请凭证")]),_:1})])])}}});const L=O(A,[["__scopeId","data-v-58e920ba"]]);export{L as default};
